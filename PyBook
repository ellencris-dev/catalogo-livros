import json
ARQUIVO = 'livros.json'


def carregar():
    try:
        with open(ARQUIVO, 'r', encoding='utf-8') as arquivo:
            return json.load(arquivo)
    except:
        return []
    
def salvar(livros):
    with open(ARQUIVO, 'w', encoding='utf-8') as arquivo:
        json.dump(livros, arquivo, indent=4, ensure_ascii=False)


def listar (livros):
    if len(livros) == 0:
        print('Nenhum livro cadastrado.')
        return
    
    for livro in livros: 
        print('--------------------')
        print("ID:", livro['id'])
        print("Título:", livro['titulo'])
        print("Autor:", livro['autor'])
        print("Ano:", livro['ano'])
        print('Genero:', livro['genero'])
        print('--------------------')

def criar(livros):
    titulo = input('Título: ')
    autor = input('Autor: ')
    ano = input('Ano: ')
    genero = input('Gênero: ')

    if titulo == '' or autor == '' or genero == '':
        print(' Esse campo não pode ficar vazio. Tente novamente.')
        return
    
    novo_id = len(livros) + 1
    livro = {
        'id': novo_id,
        'titulo': titulo,
        'autor': autor,
        'ano': ano,
        'genero': genero
    }
    livros.append(livro)
    salvar(livros)
    print('Livro cadastrado com sucesso!')

def ler(livros):
    try: 
        id_busca = int(input('Digite o ID do livro: '))
    except: 
        print('ID inválido. Tente novamente.')
        return
    for livro in livros:
        if livro ['id']== id_busca:
            print(livro)
            return
    print('Livro não encontrado.')

def atualizar(livros):
    try:
        id_busca = int(input('Digite o ID do livro: '))
    except:
        print('ID inválido. Tente novamente.')
        return
    
    for livro in livros:
        if livro['id'] == id_busca:
            livro['titulo'] = input('Novo titulo: ')
            livro['autor'] = input('Novo autor: ')
            livro['ano'] = input('Novo ano: ')
            livro['genero'] = input('Novo gênero: ')

            
            salvar(livros)
            print('Livro atualizado com sucesso!')
            return
    print('Livro não encontrado.')

def deletar(livros):
    try:
        id_busca = int(input('Digite o ID do livro: '))
    except:
        print('ID inválido. Tente novamente.')
        return
    
    for livro in livros: 
        if livro['id'] == id_busca:
            livros.remove(livro)
            salvar(livros)
            print('Livro removido com sucesso!')
            return
    print('Livro não encontrado.')

livros = carregar()

print('----------------------------------')
print('              PyBook')
print('----------------------------------')
print('Bem-vindo ao Catálogos de Livros Online, o lugar onde você pode cadastrar, consultar, atualizar e remover livros de forma simples.')

while True:
    print("""
1 - Listar livros
2 - Cadastrar livro
3 - Ler livro por ID
4 - Atualizar livro
5 - Deletar livro
0 - Sair
""")
    escolha = input('Escolha uma opção: ')
    
    if escolha == '1':
        listar(livros)
    elif escolha == '2':
        criar(livros)
    elif escolha == '3':
        ler(livros)
    elif escolha == '4':
        atualizar(livros)
    elif escolha == '5':
        deletar(livros)
    elif escolha == '0':
        print('Saindo do programa. Até logo!')
        break
    else:
        print('Opção inválida. Tente novamente.') 